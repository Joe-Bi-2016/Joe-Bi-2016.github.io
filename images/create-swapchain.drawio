<mxfile host="app.diagrams.net" modified="2024-06-17T09:53:23.092Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36" etag="jhaJbq8GiBzhbHBXijPf" version="24.5.4" type="device" pages="2">
  <diagram name="第 1 页" id="PWTuTpFlzGb3xEjpD_pd">
    <mxGraphModel dx="1120" dy="434" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="GDjtk2IAJy_e6aHsBiDq-2" target="GDjtk2IAJy_e6aHsBiDq-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="60" y="10" width="390" height="260" as="geometry" />
        </mxCell>
        <mxCell id="eBX-vIz7t_lqOZiDzeKA-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="GDjtk2IAJy_e6aHsBiDq-3" target="GDjtk2IAJy_e6aHsBiDq-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-3" value="&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;monado\src\xrt\ipc\android\src\main\java\org\&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;freedesktop\monado\ipc\Client.java&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="260" y="20" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-4" value="&lt;font style=&quot;font-size: 13px;&quot;&gt;public int blockingConnect(Context context_, String packageName) {&lt;/font&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;......&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;new Thread(&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;......&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;Surface surface = attachViewAndGetSurface(activity);&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;monado.passAppSurface(surface);&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;......&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;).start();&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;......&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99FFCC;" parent="1" vertex="1">
          <mxGeometry x="67" y="52" width="375" height="198" as="geometry" />
        </mxCell>
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-6" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="490" y="20" width="340" height="240" as="geometry" />
        </mxCell>
        <mxCell id="eBX-vIz7t_lqOZiDzeKA-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="GDjtk2IAJy_e6aHsBiDq-7" target="GDjtk2IAJy_e6aHsBiDq-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eBX-vIz7t_lqOZiDzeKA-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="GDjtk2IAJy_e6aHsBiDq-7" target="GDjtk2IAJy_e6aHsBiDq-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eBX-vIz7t_lqOZiDzeKA-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="GDjtk2IAJy_e6aHsBiDq-7" target="GDjtk2IAJy_e6aHsBiDq-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eBX-vIz7t_lqOZiDzeKA-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="GDjtk2IAJy_e6aHsBiDq-7" target="GDjtk2IAJy_e6aHsBiDq-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-7" value="&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;monado\src\xrt\ipc\android\src\main\java\org\&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;freedesktop\monado\ipc\MonadoImpl.java&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="620" y="30" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-8" value="&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;public void passAppSurface(Surface surface) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Log.i(TAG, &quot;passAppSurface&quot;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; if (surface == null) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Log.e(TAG, &quot;Received a null Surface from the client!&quot;);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; return;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; nativeAppSurface(surface);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&amp;nbsp; &amp;nbsp; }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99FFCC;" parent="1" vertex="1">
          <mxGeometry x="500" y="70" width="320" height="180" as="geometry" />
        </mxCell>
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-10" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="220" y="298" width="520" height="260" as="geometry" />
        </mxCell>
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-11" value="&lt;div&gt;monado\src\xrt\targets\service-lib\service_target.cpp&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="307" y="302" width="310" height="30" as="geometry" />
        </mxCell>
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-12" value="&lt;div&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;extern &quot;C&quot; JNIEXPORT void JNICALL&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 14px; background-color: initial;&quot;&gt;Java_org_freedesktop_monado_ipc_MonadoImpl_nativeAppSurface(&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; background-color: initial;&quot;&gt;JNIEnv *env, jobject thiz, jobject surface)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;jni::init(env);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;Surface surf(surface);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;jni::Object monadoImpl(thiz);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;ANativeWindow *nativeWindow = ANativeWindow_fromSurface(env, surface);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#ff0000&quot;&gt;android_globals_store_window((struct _ANativeWindow *)nativeWindow);&lt;/font&gt; // 将surface存储起来了，为后面创建hardwarebuffer使用&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 14px;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99FFCC;" parent="1" vertex="1">
          <mxGeometry x="228" y="334" width="500" height="210" as="geometry" />
        </mxCell>
        <mxCell id="GDjtk2IAJy_e6aHsBiDq-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.585;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1.003;exitY=0.433;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="GDjtk2IAJy_e6aHsBiDq-6" target="GDjtk2IAJy_e6aHsBiDq-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xKsRZuZpVONsm1UC5AaR-1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" vertex="1" parent="1">
          <mxGeometry x="30" y="590" width="540" height="365" as="geometry" />
        </mxCell>
        <mxCell id="xKsRZuZpVONsm1UC5AaR-2" value="&lt;font style=&quot;font-size: 13px;&quot;&gt;static bool&amp;nbsp;select_target_factory_from_settings(...) {&lt;/font&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;......&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;for (size_t i = 0; i &amp;lt; ARRAY_SIZE(ctfs); i++) {&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 13px; white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#ff0000&quot;&gt;const struct comp_target_factory *ctf = ctfs[i]; // ctfs里定义了&lt;/font&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 13px;&quot;&gt;&lt;font color=&quot;#ff00ff&quot;&gt;comp_target_factory_android&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;if (strcmp(ctf-&amp;gt;identifier, identifier) == 0) {&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;*out_ctf = ctf;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;return true;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;}&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;......&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 13px;&quot;&gt;&lt;font style=&quot;font-size: 13px;&quot;&gt;}&lt;/font&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99FFCC;" vertex="1" parent="1">
          <mxGeometry x="37" y="695" width="523" height="230" as="geometry" />
        </mxCell>
        <mxCell id="xKsRZuZpVONsm1UC5AaR-3" value="&lt;font color=&quot;#ff0000&quot;&gt;init_all()-&amp;gt;xrt_instance_create_system()-&amp;gt;t_instance_create_system()-&amp;gt;comp_main_create_system_compositor()-&amp;gt;compositor_init_window_pre_vulkan()-&amp;gt;&lt;/font&gt;&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;select_target_factory_from_settings()&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;monado\src\xrt\ipc\server\ipc_server_process.c&lt;br&gt;&lt;/div&gt;&lt;div&gt;monado\src\xrt\targets\common\target_instance.c&lt;br&gt;&lt;/div&gt;&lt;div&gt;monado\src\xrt\compositor\main\comp_compositor.c&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="60" y="600" width="480" height="75" as="geometry" />
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" vertex="1" parent="1">
          <mxGeometry x="28.5" y="990" width="540" height="360" as="geometry" />
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-3" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;const struct comp_target_factory &lt;font style=&quot;font-size: 14px;&quot; color=&quot;#ff00ff&quot;&gt;comp_target_factory_android&lt;/font&gt; = {&lt;/font&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;......&lt;br&gt;&amp;nbsp; &amp;nbsp; .create_target = create_target,&lt;br&gt;};&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;div&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;static bool&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;create_target(...) {&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;struct comp_target *ct = comp_window_android_create(c);&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;......&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;struct comp_target *&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;comp_window_android_create(struct comp_compositor *c) {&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;......&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;struct comp_window_android *w = U_TYPED_CALLOC(struct comp_window_android);&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot; color=&quot;#ff00ff&quot;&gt;w-&amp;gt;base.base.init_post_vulkan = comp_window_android_init_swapchain;&lt;/font&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;......&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;}&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99FFCC;" vertex="1" parent="1">
          <mxGeometry x="35.5" y="1030" width="523" height="290" as="geometry" />
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-4" value="&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;monado\src\xrt\compositor\main\comp_window_android.c&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="58.5" y="1000" width="480" height="20" as="geometry" />
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-5" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="xKsRZuZpVONsm1UC5AaR-2" target="pqF8ZekFjfVyNVs_1jae-3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="330" y="1020" as="sourcePoint" />
            <mxPoint x="380" y="970" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-6" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" vertex="1" parent="1">
          <mxGeometry x="629" y="990" width="570" height="360" as="geometry" />
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-7" value="&lt;div&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;static bool&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 14px; background-color: initial;&quot;&gt;comp_window_android_init_swapchain(struct comp_target *ct, uint32_t width, uint32_t height) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;struct comp_window_android *cwa = (struct comp_window_android *)ct;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;VkResult ret;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct ANativeWindow *window = NULL;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;if (&lt;font color=&quot;#ff0000&quot;&gt;android_globals_get_activity()&lt;/font&gt; != NULL) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;/* In process: Creating surface from activity */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;window = _create_android_window(cwa);&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; background-color: initial;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&lt;font color=&quot;#cc00cc&quot;&gt;ret = comp_window_android_create_surface(cwa, window, &amp;amp;cwa-&amp;gt;base.surface.handle);&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;......&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px; background-color: initial;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99FFCC;" vertex="1" parent="1">
          <mxGeometry x="636" y="1030" width="553" height="290" as="geometry" />
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-8" value="&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;monado\src\xrt\compositor\main\comp_window_android.c&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="659" y="1000" width="480" height="20" as="geometry" />
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-10" value="" style="curved=1;endArrow=classic;html=1;rounded=0;entryX=0.004;entryY=0.152;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" target="pqF8ZekFjfVyNVs_1jae-7">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="530" y="1280" as="sourcePoint" />
            <mxPoint x="580" y="1230" as="targetPoint" />
            <Array as="points">
              <mxPoint x="580" y="1280" />
              <mxPoint x="530" y="1230" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-11" value="" style="curved=1;endArrow=classic;html=1;rounded=0;entryX=0.844;entryY=0.79;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" target="GDjtk2IAJy_e6aHsBiDq-12">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="840" y="1170" as="sourcePoint" />
            <mxPoint x="710" y="880" as="targetPoint" />
            <Array as="points">
              <mxPoint x="890" y="1170" />
              <mxPoint x="840" y="1120" />
              <mxPoint x="680" y="1020" />
              <mxPoint x="560" y="870" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-12" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" vertex="1" parent="1">
          <mxGeometry x="629" y="640" width="570" height="300" as="geometry" />
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-13" value="&lt;div&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;static VkResult&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 14px; background-color: initial;&quot;&gt;comp_window_android_create_surface(struct comp_window_android *cwa,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 14px;&quot;&gt;struct ANativeWindow *window,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 14px;&quot;&gt;VkSurfaceKHR *vk_surface) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;struct vk_bundle *vk = get_vk(cwa);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;// 从surface创建&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 14px;&quot;&gt;VkSurfaceKHR&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 14px; background-color: initial;&quot;&gt;vk_surface&lt;/span&gt;&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;ret = vk-&amp;gt;&lt;font color=&quot;#ff00ff&quot;&gt;vkCreateAndroidSurfaceKHR&lt;/font&gt;( //&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; vk-&amp;gt;instance,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;amp;surface_info,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;//&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; NULL,&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; //&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; vk_surface);&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 14px; white-space: normal;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99FFCC;" vertex="1" parent="1">
          <mxGeometry x="636" y="680" width="553" height="240" as="geometry" />
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-14" value="&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;monado\src\xrt\compositor\main\comp_window_android.c&lt;/font&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="659" y="650" width="480" height="20" as="geometry" />
        </mxCell>
        <mxCell id="pqF8ZekFjfVyNVs_1jae-15" value="" style="curved=1;endArrow=classic;html=1;rounded=0;exitX=0.893;exitY=0.759;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="pqF8ZekFjfVyNVs_1jae-7">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1305.25" y="1190" as="sourcePoint" />
            <mxPoint x="1139" y="860" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1230" y="1190" />
              <mxPoint x="1250" y="1150" />
              <mxPoint x="1240" y="1000" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="a3AGtFp3HxQHCXJxpwDY" name="第 2 页">
    <mxGraphModel dx="1947" dy="434" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-11" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="-169" y="600" width="600" height="330" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-12" value="&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;xrCreateInstance-&amp;gt;oxr_xrCreateInstance-&amp;gt;oxr_instance_create&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;gt;xrt_instance_create&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;-&amp;gt;ipc_instance_create&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;monado\src\xrt\targets\openxr\target.c&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;monado\src\xrt\ipc\client\ipc_client_instance.c&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-129" y="600" width="520" height="70" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-13" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;xrt_result_t ipc_instance_create(struct xrt_instance_info *i_info, struct xrt_instance **out_xinst){&lt;/font&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;struct ipc_client_instance *ii = U_TYPED_CALLOC(struct ipc_client_instance);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;ii-&amp;gt;base.create_system = ipc_client_instance_create_system;&lt;/font&gt;&lt;font style=&quot;color: rgb(255, 51, 51); font-size: 14px;&quot;&gt; &lt;/font&gt;&lt;font style=&quot;font-size: 14px;&quot; color=&quot;#ff0000&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;// 设置创建系统函数，在&lt;/font&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;oxr_instance_create中调用&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;xrt_instance_create_system&lt;/span&gt;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;ii-&amp;gt;base.get_prober = ipc_client_instance_get_prober;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;ii-&amp;gt;base.destroy = ipc_client_instance_destroy;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;xrt_result_t xret = ipc_client_connection_init(&amp;amp;ii-&amp;gt;ipc_c, debug_get_log_option_ipc_log(), i_info); &lt;font style=&quot;font-size: 14px;&quot; color=&quot;#ff0000&quot;&gt;// 初始化基于pipe管道的相关socket通信设置，具体实现在monado\src\xrt\ipc\client\ipc_client_connection.c&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;font style=&quot;&quot; color=&quot;#ff0000&quot;&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;monado\src\xrt\ipc\android\ipc_client_android.cpp&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;......&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="-159" y="680" width="580" height="230" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-15" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="490" y="600" width="600" height="260" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-16" value="&lt;div&gt;&lt;font color=&quot;#ff0000&quot;&gt;xrCreateSession-&amp;gt;oxr_xrCreateSession-&amp;gt;&lt;span style=&quot;background-color: initial;&quot;&gt;oxr_session_create-&amp;gt;&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;oxr_session_create_impl&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;&lt;br&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;monado\src\xrt\state_trackers\oxr\oxr_api_session.c&lt;/span&gt;&lt;/div&gt;&lt;div&gt;monado\src\xrt\state_trackers\oxr\oxr_session.c&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="530" y="600" width="520" height="60" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-17" value="&lt;div style=&quot;font-size: 15px;&quot;&gt;&lt;font style=&quot;font-size: 15px;&quot;&gt;static XrResult&amp;nbsp;&lt;span style=&quot;background-color: initial;&quot;&gt;oxr_session_create_impl(......) {&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 15px;&quot;&gt;......&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 15px;&quot;&gt;&lt;div style=&quot;&quot;&gt;OXR_SESSION_ALLOCATE_AND_INIT(log, sys, *out_session);&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;OXR_ALLOCATE_NATIVE_COMPOSITOR(log, xsi, *out_session);&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;return oxr_session_populate_gles_android(log, sys, opengles_android, *out_session);&lt;/font&gt;&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#33ffff&quot; style=&quot;font-size: 15px;&quot;&gt;......&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;font-size: 15px;&quot;&gt;}&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="500" y="670" width="580" height="170" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-18" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="-179" y="970" width="549" height="260" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-19" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(255, 0, 0); font-size: 14px;&quot;&gt;oxr_instance_create-&amp;gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(255, 0, 0); font-size: 14px; background-color: initial;&quot;&gt;xrt_instance_create_system-&amp;gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px; background-color: initial;&quot;&gt;ipc_client_instance_create_system-&amp;gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 14px;&quot;&gt;create_system_compositor&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 14px;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;monado\src\xrt\ipc\client\ipc_client_instance.c&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-139" y="970" width="520" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-20" value="&lt;font style=&quot;font-size: 15px;&quot;&gt;static xrt_result_tcreate_system_compositor(...) {&amp;nbsp;&lt;/font&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;&lt;font style=&quot;font-size: 15px;&quot;&gt;......&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;&lt;font style=&quot;font-size: 15px;&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;xina = android_ahardwarebuffer_allocator_create()&lt;/font&gt;; // 设置hardwaredbuffer分配器&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;&lt;font style=&quot;font-size: 15px;&quot;&gt;&lt;font color=&quot;#cc00cc&quot;&gt;int ret = ipc_client_create_system_compositor(&amp;amp;ii-&amp;gt;ipc_c, xina, xdev, &amp;amp;xsysc);&amp;nbsp;&lt;/font&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;// 设置创建系统合成器函数&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;c-&amp;gt;system.create_native_compositor = ipc_syscomp_create_native_compositor;&lt;/span&gt;&lt;br&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 15px;&quot;&gt;&lt;font style=&quot;font-size: 15px;&quot;&gt;......&lt;br&gt;&lt;/font&gt;&lt;div&gt;&lt;font style=&quot;font-size: 15px;&quot;&gt;}&lt;/font&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="-169" y="1040" width="529" height="170" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-21" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.119;exitY=0.996;exitDx=0;exitDy=0;exitPerimeter=0;strokeColor=#000000;" parent="1" source="AjgU0O0R9-FL5qgGnKNj-13" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="49" y="910" as="sourcePoint" />
            <mxPoint x="-90" y="1040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-22" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="-184.5" y="1250" width="549" height="240" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-23" value="&lt;div&gt;monado\src\xrt\auxiliary\android\android_ahardwarebuffer_allocator.c&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-136.5" y="1250" width="444.5" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-24" value="&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;android_ahardwarebuffer_allocator_create()&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 15px; background-color: initial;&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct xrt_image_native_allocator *xina = U_TYPED_CALLOC(struct xrt_image_native_allocator);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;&lt;font color=&quot;#ff0000&quot;&gt;xina-&amp;gt;images_allocate = ahardwarebuffer_images_allocate;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;xina-&amp;gt;images_free = ahardwarebuffer_images_free;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;xina-&amp;gt;destroy = ahardwarebuffer_destroy;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;return xina;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="-174.5" y="1280" width="529" height="190" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-25" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.073;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="AjgU0O0R9-FL5qgGnKNj-24" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="-90" y="1090" as="sourcePoint" />
            <mxPoint x="180" y="1210" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-26" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="-189" y="1518" width="549" height="260" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-27" value="&lt;div&gt;monado\src\xrt\auxiliary\android\android_ahardwarebuffer_allocator.c&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-141" y="1518" width="444.5" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-28" value="&lt;span style=&quot;font-size: 15px;&quot;&gt;static xrt_result_tahardwarebuffer_images_allocate(...) {&amp;nbsp;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;for (size_t i = 0; i &amp;lt; image_count; ++i) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;int ret = AHardwareBuffer_allocate(&amp;amp;desc, &amp;amp;(out_images[i].handle));&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;if (ret != 0) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&lt;/span&gt;AHB_ERROR(&quot;Failed allocating image %d.&quot;, (int)i);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&lt;/span&gt;failed = true;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&lt;/span&gt;break;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="-179" y="1548" width="529" height="212" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-29" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.888;entryY=0.005;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="AjgU0O0R9-FL5qgGnKNj-28" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="291" y="1375" as="sourcePoint" />
            <mxPoint x="480" y="1440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-30" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="490" y="890" width="600" height="170" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-31" value="&lt;div&gt;xrCreateSession-&amp;gt;oxr_xrCreateSession-&amp;gt;&lt;span style=&quot;background-color: initial;&quot;&gt;oxr_session_create-&amp;gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;oxr_session_create_impl&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="530" y="890" width="520" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-32" value="&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;#define OXR_ALLOCATE_NATIVE_COMPOSITOR(LOG, XSI, SESS) \&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;xrt_result_t xret = xrt_syscomp_create_native_compositor((SESS)-&amp;gt;sys-&amp;gt;xsysc, (XSI), &amp;amp;(SESS)-&amp;gt;xcn);&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="500" y="920" width="580" height="120" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-33" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="567" y="759" as="sourcePoint" />
            <mxPoint x="547" y="919" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-34" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.943;entryY=0.588;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.034;exitY=0.583;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="AjgU0O0R9-FL5qgGnKNj-32" target="AjgU0O0R9-FL5qgGnKNj-20" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="530" y="1160" as="sourcePoint" />
            <mxPoint x="580" y="1110" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-35" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="490" y="1080" width="600" height="210" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-36" value="&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;monado\src\xrt\ipc\client\ipc_client_compositor.c&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="550" y="1080" width="520" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-37" value="&lt;div&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;xrt_result_t&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 15px; background-color: initial;&quot;&gt;ipc_syscomp_create_native_compositor(...) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px; background-color: initial;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;IPC_CALL_CHK(ipc_call_session_create(icc-&amp;gt;ipc_c, xsi));&lt;/font&gt; // 与server端通信，发送创建session命令&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;ipc_compositor_init(icc, out_xcn); // 设置了client创建ipc_compositor_swapchain_create，&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;ipc_compositor_swapchain_import&lt;/span&gt;&lt;span style=&quot;font-size: 15px; background-color: initial;&quot;&gt;等函数&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px; background-color: initial;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-size: 15px; background-color: initial;&quot;&gt;}&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="500" y="1102" width="580" height="168" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-38" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.754;exitY=0.706;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="AjgU0O0R9-FL5qgGnKNj-20" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="440" y="1230" as="sourcePoint" />
            <mxPoint x="490" y="1180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-39" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="490" y="1320" width="600" height="220" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-40" value="monado\src\xrt\state_trackers\oxr\oxr_session_gfx_gles_android.c" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="530" y="1320" width="520" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-41" value="&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;XrResult&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;oxr_session_populate_gles_android(...) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;b&gt;&lt;font color=&quot;#ff00ff&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;//&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;monado\src\xrt\compositor\client\comp_egl_client.c&lt;/span&gt;&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#ff00ff&quot;&gt;&lt;b&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;//&amp;nbsp;&lt;/span&gt;&lt;/b&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;monado\src\xrt\compositor\client\comp_gl_eglimage_swapchain.c&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#ff00ff&quot;&gt;&lt;b style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;提供了从&lt;/span&gt;&lt;span style=&quot;font-size: 15px; background-color: initial;&quot;&gt;AHardwareBuffer&lt;/span&gt;&lt;/b&gt;&lt;b style=&quot;background-color: initial; font-size: 15px;&quot;&gt;创建EGLImage到纹理等相关函数&lt;/b&gt;&lt;/font&gt;&lt;b style=&quot;font-size: 15px; background-color: initial;&quot;&gt;xrt_gfx_provider_create_gl_egl(...);&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&lt;div&gt;sess-&amp;gt;compositor = &amp;amp;xcgl-&amp;gt;base; // 在&lt;b style=&quot;background-color: initial;&quot;&gt;xrt_gfx_provider_create_gl_egl中赋值&lt;/b&gt;&lt;/div&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&lt;div&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;sess-&amp;gt;create_swapchain = oxr_swapchain_gl_create;&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="500" y="1350" width="580" height="180" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-42" value="" style="curved=1;endArrow=classic;html=1;rounded=0;exitX=0.966;exitY=0.647;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.067;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="AjgU0O0R9-FL5qgGnKNj-17" target="AjgU0O0R9-FL5qgGnKNj-41" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1140" y="980" as="sourcePoint" />
            <mxPoint x="1200" y="1090" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1160" y="820" />
              <mxPoint x="1160" y="1100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-43" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" parent="1" vertex="1">
          <mxGeometry x="490" y="1560" width="600" height="240" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-44" value="monado\src\xrt\state_trackers\oxr\oxr_swapchain_gl.c" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="530" y="1560" width="520" height="30" as="geometry" />
        </mxCell>
        <mxCell id="AjgU0O0R9-FL5qgGnKNj-45" value="&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;XrResult&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;oxr_swapchain_gl_create(...) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;ret = oxr_swapchain_common_create(log, sess, createInfo, &amp;amp;sc);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;if (ret != XR_SUCCESS) {&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;return ret;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;// Set our API specific function(s).&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;sc-&amp;gt;enumerate_images = gl_enumerate_images;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px; background-color: initial; white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;font-size: 15px; background-color: initial;&quot;&gt;*out_swapchain = sc;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;......&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;}&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#CCFFFF;" parent="1" vertex="1">
          <mxGeometry x="500" y="1590" width="580" height="200" as="geometry" />
        </mxCell>
        <mxCell id="TjT7oobUID30DlpiIMY9-2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99CCFF;" vertex="1" parent="1">
          <mxGeometry x="-193" y="1816.5" width="1283" height="343.5" as="geometry" />
        </mxCell>
        <mxCell id="TjT7oobUID30DlpiIMY9-3" value="&lt;div&gt;&lt;b style=&quot;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;monado\src\xrt\state_trackers\oxr\oxr_session_gfx_gles_android.c&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/b&gt;&lt;b style=&quot;color: rgb(204, 0, 0); background-color: initial;&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;monado\src\xrt\compositor\client\comp_egl_client.c&lt;/span&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;b&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;monado\src\xrt\compositor\client\comp_gl_client.c&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;b style=&quot;font-size: 15px; background-color: initial;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;monado\src\xrt\ipc\client\ipc_client_compositor.c&amp;nbsp;&lt;/font&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;b&gt;ipc_client_generated.c&amp;nbsp;&amp;nbsp;&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;b&gt;monado\src\xrt\ipc\shared\ipc_utils.c&amp;nbsp;&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;b style=&quot;background-color: initial; color: rgb(204, 0, 0); font-size: 15px;&quot;&gt;ipc_server_generated.c&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;&quot; color=&quot;#cc0000&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&lt;b&gt;monado\src\xrt\compositor\multi\comp_multi_system.c&amp;nbsp;&amp;nbsp;&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;b&gt;monado\src\xrt\compositor\multi\comp_multi_compositor.c&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&lt;b&gt;&amp;nbsp;&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;b style=&quot;background-color: initial; font-size: 15px; color: rgb(204, 0, 0);&quot;&gt;monado\src\xrt\compositor\util\comp_base.c&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font style=&quot;&quot; color=&quot;#cc0000&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&lt;b&gt;monado\src\xrt\compositor\util\comp_swapchain.c&amp;nbsp;&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;b&gt;monado\src\xrt\auxiliary\vk\vk_image_allocator.c&amp;nbsp;&amp;nbsp;&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;b&gt;monado\src\xrt\auxiliary\vk\vk_helpers.c&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-159" y="1820.5" width="1199" height="109.5" as="geometry" />
        </mxCell>
        <mxCell id="TjT7oobUID30DlpiIMY9-4" value="&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;font color=&quot;#0000ff&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&lt;b&gt;sess-&amp;gt;compositor = &amp;amp;xcgl-&amp;gt;base;&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;b style=&quot;color: rgb(0, 0, 255); font-size: 15px;&quot;&gt;&amp;nbsp;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;font color=&quot;#0000ff&quot;&gt;&lt;b&gt;sess-&amp;gt;create_swapchain = oxr_swapchain_gl_create;&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;font color=&quot;#0000ff&quot;&gt;在&lt;/font&gt;&lt;/span&gt;&lt;b style=&quot;color: rgb(0, 0, 255); background-color: initial; font-size: 15px;&quot;&gt;xrt_gfx_provider_create_gl_egl函数中设置的回调函数，最终到server端调用&lt;/b&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#00cc66&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;sess-&amp;gt;create_swapchain(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;oxr_swapchain_common_create(...)-&amp;gt;xrt_comp_create_swapchain(sess-&amp;gt;compositor, &amp;amp;info, &amp;amp;xsc);&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;&lt;font color=&quot;#cc00cc&quot;&gt;xrt_gfx_provider_create_gl_egl(..., xcgl)-&amp;gt;get_client_gl_functions(...)-&amp;gt;client_gl_eglimage_swapchain_create(...)-&amp;gt;client_gl_compositor_init(...)&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;&lt;font color=&quot;#0000ff&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#cc00cc&quot;&gt;&amp;gt;&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;&lt;font color=&quot;#cc00cc&quot;&gt;client_gl_swapchain_create(...)-&amp;gt;&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#007fff&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;xrt_comp_native_create_swapchain(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&lt;b&gt;ipc_compositor_swapchain_create(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;font-size: 15px;&quot;&gt;&lt;b&gt;swapchain_allocator_create&lt;/b&gt;&lt;/span&gt;&lt;b style=&quot;font-size: 15px;&quot;&gt;(...)&lt;/b&gt;&lt;font style=&quot;font-size: 15px; font-weight: bold;&quot;&gt;-&amp;gt;&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;xrt_images_allocate(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;swapchain_server_import(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;ipc_call_swapchain_import(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;ipc_send_handles_graphics_buffer(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;AHardwareBuffer_sendHandleToUnixSocket(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;ipc_receive_handles_graphics_buffer(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;AHardwareBuffer_recvHandleFromUnixSocket(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;ipc_handle_swapchain_import(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;xrt_comp_import_swapchain(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#ff3333&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;multi_compositor_import_swapchain(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;base_import_swapchain(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;comp_swapchain_import(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;comp_swapchain_import_init(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font color=&quot;#ff00ff&quot;&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;vk_ic_from_natives(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;vk_create_image_from_native(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;vkCreateImage(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;vk_alloc_and_bind_image_memory(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b&gt;vkAllocateMemory(...)-&amp;gt;&lt;/b&gt;&lt;/span&gt;&lt;span style=&quot;background-color: initial; font-size: 15px;&quot;&gt;&lt;b style=&quot;&quot;&gt;vkBindImageMemory(...)&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#CCFFFF;align=center;" vertex="1" parent="1">
          <mxGeometry x="-187" y="1930" width="1269" height="200" as="geometry" />
        </mxCell>
        <mxCell id="TjT7oobUID30DlpiIMY9-5" value="" style="curved=1;endArrow=classic;html=1;rounded=0;exitX=0.845;exitY=0.778;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.931;entryY=0.15;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" target="AjgU0O0R9-FL5qgGnKNj-45">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="979.9999999999999" y="1490" as="sourcePoint" />
            <mxPoint x="1069.9" y="1589.96" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1109.9" y="1519.96" />
              <mxPoint x="1119.9" y="1609.96" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="TjT7oobUID30DlpiIMY9-6" value="" style="curved=1;endArrow=classic;html=1;rounded=0;exitX=0.276;exitY=0.556;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="AjgU0O0R9-FL5qgGnKNj-41" target="TjT7oobUID30DlpiIMY9-4">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="960" y="1680" as="sourcePoint" />
            <mxPoint x="1010" y="1630" as="targetPoint" />
            <Array as="points">
              <mxPoint x="530" y="1450" />
              <mxPoint x="420" y="1490" />
              <mxPoint x="440" y="1630" />
              <mxPoint x="430" y="1700" />
              <mxPoint x="410" y="1750" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="TjT7oobUID30DlpiIMY9-8" value="" style="curved=1;endArrow=classic;html=1;rounded=0;entryX=0.149;entryY=0.104;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.581;exitY=0.536;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="TjT7oobUID30DlpiIMY9-4" target="AjgU0O0R9-FL5qgGnKNj-28">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="490" y="2070" as="sourcePoint" />
            <mxPoint x="340" y="1810" as="targetPoint" />
            <Array as="points">
              <mxPoint x="-70" y="1880" />
              <mxPoint x="-160" y="1780" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
